<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>事务的特性和隔离级别 | 打工这件小事</title><meta name="description" content="MySQL基础之事务的特性和隔离级别。"><meta name="keywords" content="MySQL"><meta name="author" content="SunChaser,admin@lilu.org.cn"><meta name="copyright" content="SunChaser"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/sunchaser-lilu/sunchaser-cdn@master/images/hexo-theme-sunchaser/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="crossorigin"/><link rel="preconnect" href="https://hm.baidu.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="twitter:card" content="summary"><meta name="twitter:title" content="事务的特性和隔离级别"><meta name="twitter:description" content="MySQL基础之事务的特性和隔离级别。"><meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/sunchaser-lilu/sunchaser-cdn@master/lilu.org.cn/cover.png"><meta property="og:type" content="article"><meta property="og:title" content="事务的特性和隔离级别"><meta property="og:url" content="https://lilu.org.cn/2020/07/12/database/mysql/transaction-characteristics-and-isolation-levels/"><meta property="og:site_name" content="打工这件小事"><meta property="og:description" content="MySQL基础之事务的特性和隔离级别。"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/sunchaser-lilu/sunchaser-cdn@master/lilu.org.cn/cover.png"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>var autoChangeMode = 'false'
var t = Cookies.get("theme")
if (autoChangeMode == '1'){
  var isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
  var isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
  var isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined){
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport){
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour < 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
  }
  } else if (t == 'light') activateLightMode()
  else activateDarkMode()

} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css"><link rel="canonical" href="https://lilu.org.cn/2020/07/12/database/mysql/transaction-characteristics-and-isolation-levels/"><link rel="prev" title="LeetCode题解-链表标签：面试题 02.07. 链表相交" href="https://lilu.org.cn/2020/07/14/algorithm/leetcode/tag/linkedlist/intersection-of-two-linked-lists-lcci/"><link rel="next" title="MySQL为什么选择可重复读作为默认的隔离级别？" href="https://lilu.org.cn/2020/07/12/database/mysql/why-does-mysql-choose-repeatable-read-as-the-default-isolation-level/"><script async="async" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?20da65740ab8563511ef3339403e6464";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-158613531-1', 'auto');
ga('send', 'pageview');
</script><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容:${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://lilu.org.cn","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"间"},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: true,
  copyright: {"languages":{"author":"作者: SunChaser","link":"链接: ","source":"来源: 打工这件小事","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: {"bookmark":{"message_prev":"按","message_next":"键将本页加入书签"},"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#2d3035","position":"bottom-left"},
  baiduPush: true,
  highlightCopy: true,
  highlightLang: true,
  highlightShrink: 'false',
  isFontAwesomeV5: false,
  isPhotoFigcaption: false
  
}</script><script>var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isSidebar: true  
  }</script><noscript><style>
#page-header {
  opacity: 1
}
.justified-gallery img{
  opacity: 1
}
</style></noscript><meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="打工这件小事" type="application/atom+xml">
</head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="https://cdn.jsdelivr.net/gh/sunchaser-lilu/sunchaser-cdn@master/images/hexo-theme-sunchaser/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">66</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">22</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">22</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div></div></div><i class="fa fa-arrow-right on" id="toggle-sidebar" aria-hidden="true">     </i><div id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#简介"><span class="toc-number">1.</span> <span class="toc-text">简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#事务特性"><span class="toc-number">2.</span> <span class="toc-text">事务特性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#并发访问的问题"><span class="toc-number">3.</span> <span class="toc-text">并发访问的问题</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#事务的隔离级别"><span class="toc-number">4.</span> <span class="toc-text">事务的隔离级别</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#深入理解事务隔离级别"><span class="toc-number">5.</span> <span class="toc-text">深入理解事务隔离级别</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#总结"><span class="toc-number">6.</span> <span class="toc-text">总结</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#参考"><span class="toc-number">7.</span> <span class="toc-text">参考</span></a></li></ol></div></div></div><div id="body-wrap"><div id="web_bg" data-type="color"></div><div class="post-bg" id="nav" style="background-image: url(https://cdn.jsdelivr.net/gh/sunchaser-lilu/sunchaser-cdn@master/lilu.org.cn/cover.png)"><div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">打工这件小事</a></span><span class="pull_right menus"><div id="search_button"><a class="site-page social-icon search"><i class="fa fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div><span class="toggle-menu close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span></span></div><div id="post-info"><div id="post-title"><div class="posttitle">事务的特性和隔离级别</div></div><div id="post-meta"><div class="meta-firstline"><time class="post-meta__date"><span class="post-meta__date-created" title="发表于 2020-07-12 00:00:00"><i class="fa fa-calendar" aria-hidden="true"></i> 发表于 2020-07-12</span><span class="post-meta__separator">|</span><span class="post-meta__date-updated" title="更新于 2020-07-12 00:00:00"><i class="fa fa-history" aria-hidden="true"></i> 更新于 2020-07-12</span></time><span class="post-meta__categories"><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a><i class="fa fa-angle-right post-meta__separator" aria-hidden="true"></i><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL/">MySQL</a></span></div><div class="meta-secondline"> <span class="post-meta-wordcount"><i class="post-meta__icon fa fa-file-word-o" aria-hidden="true"></i><span>字数总计:</span><span class="word-count">2k</span><span class="post-meta__separator">|</span><i class="post-meta__icon fa fa-clock-o" aria-hidden="true"></i><span>阅读时长: 6 分钟</span></span></div><div class="meta-thirdline"><span class="post-meta-pv-cv"><span class="post-meta__separator">|</span><i class="fa fa-eye post-meta__icon" aria-hidden="true"> </i><span>阅读量:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-commentcount"><span class="post-meta__separator">|</span><i class="post-meta__icon fa fa-comment-o" aria-hidden="true"></i><span>评论数:</span><a href="/2020/07/12/database/mysql/transaction-characteristics-and-isolation-levels/#post-comment" itemprop="discussionUrl"><span class="valine-comment-count comment-count" data-xid="/2020/07/12/database/mysql/transaction-characteristics-and-isolation-levels/" itemprop="commentCount"></span></a></span></div></div></div></div><main class="layout_post" id="content-inner"><article id="post"><span style="display: none;">版权所有，禁止爬虫。</span><div class="post-copyright__author" style="display: none;"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:admin@lilu.org.cn">SunChaser</a></span></div><div class="post-copyright__type" style="display: none;"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://lilu.org.cn/2020/07/12/database/mysql/transaction-characteristics-and-isolation-levels/">https://lilu.org.cn/2020/07/12/database/mysql/transaction-characteristics-and-isolation-levels/</a></span></div><div class="post-copyright__notice" style="display: none;"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://lilu.org.cn" target="_blank">打工这件小事</a>！</span></div><div id="article-container"><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>提起数据库，那不得不说到事务，但事务并不是<code>MySQL</code>数据库的专属，而是<code>SQL</code>语言的特性，事务就是一组原子性的<code>SQL</code>查询。该组查询语句要么全部执行成功，要么全部执行失败。如果其中有任何一条语句执行失败或因为数据库奔溃等其它原因无法执行，那么所有语句都不会执行。</p>
<h2 id="事务特性"><a href="#事务特性" class="headerlink" title="事务特性"></a>事务特性</h2><p>事务的特性就是我们俗称的<code>ACID</code>，下面依次进行解释：</p>
<ol>
<li><code>A</code>：原子性（<code>Atomicity</code>）</li>
</ol>
<p>一个事务必须是一个不可分割的最小执行单元，整个事务中的所有操作要么全部执行成功，要么全部执行失败后回滚，对于一个事务而言，不可能出现其中一部分操作执行成功，另一部分操作执行失败的情况，这就是事务的原子性。</p>
<ol start="2">
<li><code>C</code>：一致性（<code>consistency</code>）</li>
</ol>
<p>数据库总是从一个一致性的状态转换到另一个一致性的状态。例如银行转账，用户<code>A</code>的账户向用户<code>B</code>的账户转账<code>100</code>元人民币，在这个事务中，首先会从用户<code>A</code>的账户中扣减<code>100</code>元，然后给用户<code>B</code>的账户增加<code>100</code>元，由于事务的原子性的保证，即使在从用户<code>A</code>的账户中扣减<code>100</code>元后数据库系统奔溃，用户<code>A</code>的账户上也不会损失<code>100</code>元，因为事务没有最终进行提交，用户<code>A</code>的账户扣减不会保存至数据库中，同时由于系统奔溃，用户<code>B</code>的账户也不会增加金额。也就是说，经过一次事务，整个账户系统中的金额总数不会改变，这就是事务的一致性。</p>
<ol start="3">
<li><code>I</code>：隔离性（<code>isolation</code>）</li>
</ol>
<p>隔离性是指多个客户端并发访问数据库时，一个客户端的事务不能被其它客户端的事务所干扰，并发事务之间要做到事务隔离。</p>
<p>隔离性需要结合事务的隔离级别来说，下文会对事务的隔离级别进行展开说明。</p>
<p>通常的隔离性是：一个事务中的修改在最终提交事务之前，对其它事务是不可见的。还是银行转账的例子，在用户<code>A</code>给用户<code>B</code>转账的事务提交之前，如果用户<code>A</code>还向另一个用户<code>C</code>转账，这时候看用户<code>A</code>的账户是还未扣减<code>100</code>元的，这就是事务的隔离性。</p>
<ol start="4">
<li><code>D</code>：持久性（<code>durability</code>）</li>
</ol>
<p>一旦事务提交，则该事务中所做的所有修改都将永久保存至数据库中，会被持久化至磁盘上，即使此时系统发生奔溃，事务中发生修改的数据也不会丢失。</p>
<p>在<code>MySQL</code>中，事务的实现在引擎层。<code>MySQL</code>是一个支持多引擎的系统，但并不是所有引擎都支持事务，例如<code>MySQL</code>原生的<code>MyISAM</code>引擎就不支持事务，而我们熟知的<code>InnoDB</code>引擎则是支持事务的。</p>
<h2 id="并发访问的问题"><a href="#并发访问的问题" class="headerlink" title="并发访问的问题"></a>并发访问的问题</h2><p>当多个事务并发执行的时候，就会出现并发问题，为了解决这些问题，提出了隔离级别的概念，每一种隔离级别都可以解决一个并发问题。</p>
<p>事务的并发执行存在以下三种问题：</p>
<ol>
<li>脏读</li>
</ol>
<p>一个事务读到了另一个事务中未提交的数据。</p>
<ol start="2">
<li>不可重复读</li>
</ol>
<p>假设存在这样一个事务，首先查询一条记录，然后修改该条记录的值，再次查询该条记录，那么对于这个事务而言，两次查询到的记录的值不一致，这被称为不可重复读。</p>
<ol start="3">
<li>幻读</li>
</ol>
<p>假设存在这样一个事务，首先条件查询某个范围内的记录，此时某个并发执行的其它事务在该范围内插入了新的记录，当之前的事务再次以相同的条件范围查询时，就会查询到新插入的行（称为幻行）。<code>InnoDB</code>引擎通过多版本并发控制（<code>MVCC</code>）来解决幻读的问题。</p>
<h2 id="事务的隔离级别"><a href="#事务的隔离级别" class="headerlink" title="事务的隔离级别"></a>事务的隔离级别</h2><p>每一种隔离级别都解决了一个并发问题，但必须明白，问题解决的越多，效率就会越低。因此很多时候我们需要根据实际业务场景来选择合适的隔离级别。</p>
<p><code>SQL</code>标准的事务隔离级别包括：读未提交（<code>read uncommitted</code>）、读已提交（<code>read committed</code>）、可重复读（<code>repeatable read</code>）和串行化（<code>serializable</code>）。</p>
<ol>
<li>读未提交（<code>read uncommitted</code>）</li>
</ol>
<p>可读取其它事务中未提交的数据，不能解决任何并发问题。</p>
<ol start="2">
<li>读已提交（<code>read committed</code>）</li>
</ol>
<p>只能读取其它事务中已提交的数据，可以解决脏读问题。</p>
<ol start="3">
<li>可重复读（<code>repeatable read</code>）</li>
</ol>
<p>一个事务执行过程中能读取到的数据，总是跟这个事务在启动时读到的数据保持一致。可以解决脏读和不可重复读问题。</p>
<p>实现原理是在事务启动时创建一个视图，整个事务存在期间都会查询该视图。</p>
<ol start="4">
<li>串行化（<code>serializable</code>）</li>
</ol>
<p>最高的事务隔离级别，使用读写锁强制所有操作串行排队执行，解决了所有的并发问题。但其效率也最为低下。对于同一行记录，“写”会加“写锁”，“读”会加“读锁”。当出现读写锁冲突时，后启动的事务必须等待前一个事务执行完并提交后，才能执行。</p>
<p>不同隔离级别之间的性能比较（从高到低）：读未提交 &gt; 读已提交 &gt; 可重复读 &gt; 串行化。</p>
<p>性能越高，并发安全性越低。<code>MySQL</code>在<code>5.0</code>版本之后开始，选择可重复读做为默认的隔离级别。</p>
<blockquote>
<p><code>MySQL</code>为什么选择可重复读作为默认的隔离级别？</p>
<p><a href="/2020/07/12/database/mysql/why-does-mysql-choose-repeatable-read-as-the-default-isolation-level/">传送门</a></p>
</blockquote>
<h2 id="深入理解事务隔离级别"><a href="#深入理解事务隔离级别" class="headerlink" title="深入理解事务隔离级别"></a>深入理解事务隔离级别</h2><p>这里我们用一个例子来尝试理解事务的隔离级别。</p>
<p>初始化表<code>T</code>，插入一条记录：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`T`</span> (</span><br><span class="line">  <span class="string">`id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  <span class="string">`num`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8mb4;</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="string">`T`</span> (<span class="string">`num`</span>) <span class="keyword">values</span> (<span class="number">1</span>);</span><br></pre></td></tr></table></figure>

<p>假设有两个事务的执行顺序如以下表格所示：</p>
<table>
<thead>
<tr>
<th align="center">时间轴</th>
<th align="center">事务1</th>
<th align="center">事务2</th>
</tr>
</thead>
<tbody><tr>
<td align="center">t0</td>
<td align="center">begin</td>
<td align="center">begin</td>
</tr>
<tr>
<td align="center">t1</td>
<td align="center">select num from <code>T</code> where id = 1;</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">t2</td>
<td align="center"></td>
<td align="center">select num from <code>T</code> where id = 1;</td>
</tr>
<tr>
<td align="center">t3</td>
<td align="center"></td>
<td align="center">update <code>T</code> set num = 2 where id = 1;</td>
</tr>
<tr>
<td align="center">t4</td>
<td align="center">select num from <code>T</code> where id = 1;</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">t5</td>
<td align="center"></td>
<td align="center">commit;</td>
</tr>
<tr>
<td align="center">t6</td>
<td align="center">select num from <code>T</code> where id = 1;</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">t7</td>
<td align="center">commit;</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">t8</td>
<td align="center">select num from <code>T</code> where id = 1;</td>
<td align="center"></td>
</tr>
</tbody></table>
<p><code>t1</code>时刻事务<code>1</code>查询得到的<code>num</code>值为<code>1</code>。</p>
<p>设<code>t4</code>时刻事务<code>1</code>查询得到的<code>num</code>值为<code>N1</code>，<code>t6</code>时刻事务<code>1</code>查询得到的<code>num</code>值为<code>N2</code>，<code>t8</code>时刻事务<code>1</code>查询得到的<code>num</code>值为<code>N3</code>。</p>
<p>在不同隔离级别下，<code>N1</code>、<code>N2</code>和<code>N3</code>的值会一样吗？分别是多少？</p>
<ol>
<li>读未提交隔离级别下：</li>
</ol>
<p>事务<code>1</code>可读到事务<code>2</code>中未提交数据，于是<code>N1=N2=N3=2</code>。</p>
<ol start="2">
<li>读已提交隔离级别下：</li>
</ol>
<p>事务<code>1</code>只能读到事务<code>2</code>中已提交的数据，于是<code>N1=1, N2=2, N3=2</code>。</p>
<ol start="3">
<li>可重复读隔离级别下：</li>
</ol>
<p>事务<code>1</code>中读到的数据总是跟该事务刚启动时读到的数据保持一致，于是<code>N1=1, N2=1, N3=2</code>。</p>
<ol start="4">
<li>串行化隔离级别下：</li>
</ol>
<p>对同一行数据的操作强制排队执行。<code>t1</code>时刻事务<code>1</code>加读锁；<code>t2</code>时刻事务<code>2</code>加读锁；<code>t3</code>时刻事务<code>2</code>尝试加写锁，进入阻塞状态，等待事务<code>1</code>提交后才会执行<code>update</code>；<code>t8</code>时刻事务<code>2</code>已提交。于是<code>N1=1, N2=1, N3=2</code>。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>事务的四大特性：<code>ACID</code>；</p>
<p>事务的并发问题：脏读、不可重复读和幻读。</p>
<p>事务的隔离级别：读未提交、读已提交（解决了脏读）、可重复读（解决了不可重复读）和串行化（解决了幻读，无并发问题）。</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li>《MySQL实战45讲》 - 极客时间</li>
</ul>
<div><div style="text-align:center;color: #ccc;font-size:14px;font-family: cursive;">-------------&#x6709;&#x8FC7;&#x7275;&#x6302;<i class="fa fa-umbrella" style="margin:0 7px;"></i>&#x4E86;&#x65E0;&#x7275;&#x6302;-------------</div></div><div id="wechat_subscriber"><center><img id="wechat_subscriber_qcode" src="https://cdn.jsdelivr.net/gh/sunchaser-lilu/sunchaser-cdn@master/images/hexo-theme-sunchaser/wxgzh.png" onerror="onerror=null;src='/assets/images/wechat/wxgzh.jpg'" alt="向日葵的自我修养"></center><div>欢迎关注我的微信公众号~</div></div></div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:admin@lilu.org.cn">SunChaser</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://lilu.org.cn/2020/07/12/database/mysql/transaction-characteristics-and-isolation-levels/">https://lilu.org.cn/2020/07/12/database/mysql/transaction-characteristics-and-isolation-levels/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://lilu.org.cn" target="_blank">打工这件小事</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/MySQL/">MySQL</a></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/sunchaser-lilu/sunchaser-cdn@master/lilu.org.cn/cover.png" data-sites="wechat,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"/><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><div class="post-reward"><a class="reward-button button--primary button--animated"> <i class="fa fa-qrcode"></i> 打赏<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="lazyload post-qr-code__img" src="https://cdn.jsdelivr.net/gh/sunchaser-lilu/sunchaser-cdn@master/images/hexo-theme-sunchaser/wechat.png" alt="微信"/><div class="post-qr-code__desc">微信</div></li><li class="reward-item"><img class="lazyload post-qr-code__img" src="https://cdn.jsdelivr.net/gh/sunchaser-lilu/sunchaser-cdn@master/images/hexo-theme-sunchaser/alipay.png" alt="支付宝"/><div class="post-qr-code__desc">支付宝</div></li></ul></div></a></div><div class="post-ad"><ins class="adsbygoogle" style="display:block;text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-4923931760030983" data-ad-slot="5533486997"></ins><script>(adsbygoogle=window.adsbygoogle || []).push({})</script></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/2020/07/14/algorithm/leetcode/tag/linkedlist/intersection-of-two-linked-lists-lcci/"><img class="prev_cover lazyload" data-src="https://cdn.jsdelivr.net/gh/sunchaser-lilu/sunchaser-cdn@master/lilu.org.cn/cover.png" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">LeetCode题解-链表标签：面试题 02.07. 链表相交</div></div></a></div><div class="next-post pull_right"><a href="/2020/07/12/database/mysql/why-does-mysql-choose-repeatable-read-as-the-default-isolation-level/"><img class="next_cover lazyload" data-src="https://cdn.jsdelivr.net/gh/sunchaser-lilu/sunchaser-cdn@master/lilu.org.cn/cover.png" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">MySQL为什么选择可重复读作为默认的隔离级别？</div></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fa fa-fw fa-thumbs-up" aria-hidden="true"></i><span> 相关推荐</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/2020/07/12/database/mysql/why-does-mysql-choose-repeatable-read-as-the-default-isolation-level/" title="MySQL为什么选择可重复读作为默认的隔离级别？"><img class="relatedPosts_cover lazyload"data-src="https://cdn.jsdelivr.net/gh/sunchaser-lilu/sunchaser-cdn@master/lilu.org.cn/cover.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-history fa-fw" aria-hidden="true"></i> 2020-07-12</div><div class="relatedPosts_title">MySQL为什么选择可重复读作为默认的隔离级别？</div></div></a></div></div><div class="clear_both"></div></div><hr><div id="post-comment"><div class="comment_headling"><i class="fa fa-comments fa-fw" aria-hidden="true"></i><span> 评论</span></div><div class="vcomment" id="vcomment"></div><script src="https://cdn.jsdelivr.net/gh/xaoxuu/volantis/js/volantis.min.js"></script><script>var GUEST_INFO = ['nick','mail','link'];
var guest_info = 'nick,mail,link'.split(',').filter(function(item){
  return GUEST_INFO.indexOf(item) > -1
});
guest_info = guest_info.length == 0 ? GUEST_INFO :guest_info;

window.valine = new Valine({
  el:'#vcomment',
  notify: false,
  verify: false,
  appId: 'qc8Hd8UPK33VUIOJ3zDjAn8W-gzGzoHsz',
  appKey: 'K2EAXbjfO9i6G4Myz0gHIIgr',
  placeholder: '记得留下你的昵称和邮箱...可以快速收到回复哦',
  avatar: 'monsterid',
  meta: guest_info,
  pageSize: '10',
  lang: 'zh-cn',
  recordIP: false,
  serverURLs: ''
});</script></div></article></main><footer id="footer" style="background-image: url(https://cdn.jsdelivr.net/gh/sunchaser-lilu/sunchaser-cdn@master/lilu.org.cn/cover.png)" data-type="photo"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2020 By SunChaser</div><div class="framework-info"><span>驱动 </span><a href="https://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/sunchaser-lilu/hexo-theme-sunchaser" target="_blank" rel="noopener"><span>SunChaser</span></a></div><div class="footer_custom_text">没有行动的梦想都是妄想~</div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换" target="_self">繁</a><i class="darkmode fa fa-moon-o" id="darkmode" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><a id="to_comment" href="#post-comment" title="直达评论"><i class="scroll_to_comment fa fa-comments">  </i></a><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a href="https://github.com/wzpan/hexo-generator-search" target="_blank" rel="noopener" style="color:#49B1F5;">hexo-generator-search</a>
 <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script id="canvas_nest" color="255,0,0" opacity="1" zIndex="-1" count="99" mobile="false" src="/js/third-party/canvas-nest.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/lazysizes@latest/lazysizes.min.js" async=""></script><script src="/js/search/local-search.js"></script><script>if (document.getElementsByClassName('mermaid').length) {
  loadScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js',function () {
    mermaid.initialize({
      theme: 'neutral',
  })
})
}</script></body></html>