<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>分库分表中间件之ShardingSphere-入门案例 | 向日葵的自我修养</title><meta name="description" content="分库分表中间件之ShardingSphere-入门案例"><meta name="keywords" content="Apache ShardingSphere"><meta name="author" content="SunChaser,admin@lilu.org.cn"><meta name="copyright" content="SunChaser"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/../assets/images/themes/butterfly/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="crossorigin"/><link rel="preconnect" href="https://hm.baidu.com"/><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin="crossorigin"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="twitter:card" content="summary"><meta name="twitter:title" content="分库分表中间件之ShardingSphere-入门案例"><meta name="twitter:description" content="分库分表中间件之ShardingSphere-入门案例"><meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/sunchaser-lilu/sunchaser-cdn@master/lilu.org.cn/cover.png"><meta property="og:type" content="article"><meta property="og:title" content="分库分表中间件之ShardingSphere-入门案例"><meta property="og:url" content="https://lilu.org.cn/2019/12/12/middleware/sharding-sphere/sharding-jdbc-introduction/"><meta property="og:site_name" content="向日葵的自我修养"><meta property="og:description" content="分库分表中间件之ShardingSphere-入门案例"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/sunchaser-lilu/sunchaser-cdn@master/lilu.org.cn/cover.png"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>var autoChangeMode = '1'
var t = Cookies.get("theme")
if (autoChangeMode == '1'){
  var isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
  var isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
  var isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined){
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport){
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour < 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
  }
  } else if (t == 'light') activateLightMode()
  else activateDarkMode()

} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css"><link rel="canonical" href="https://lilu.org.cn/2019/12/12/middleware/sharding-sphere/sharding-jdbc-introduction/"><link rel="prev" title="JavaBucket" href="https://lilu.org.cn/2019/12/13/java-bucket/"><link rel="next" title="“煮熟的鸭子也会飞？”- 使用策略模式让你的“鸭子”飞起来" href="https://lilu.org.cn/2019/12/12/design-patterns/behavior/strategy/"><script async="async" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script>(adsbygoogle = window.adsbygoogle || []).push({
  google_ad_client: 'ca-pub-4923931760030983',
  enable_page_level_ads: 'true'
});</script><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?20da65740ab8563511ef3339403e6464";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-158613531-1', 'auto');
ga('send', 'pageview');
</script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容:${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://www.lilu.org.cn","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"间"},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: true,
  copyright: {"languages":{"author":"作者: SunChaser","link":"链接: ","source":"来源: 向日葵的自我修养","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: {"bookmark":{"message_prev":"按","message_next":"键将本页加入书签"},"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#2d3035","position":"bottom-left"},
  baiduPush: true,
  highlightCopy: true,
  highlightLang: true,
  highlightShrink: 'false',
  isFontAwesomeV5: false,
  isPhotoFigcaption: false
  
}</script><script>var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isSidebar: true  
  }</script><noscript><style>
#page-header {
  opacity: 1
}
.justified-gallery img{
  opacity: 1
}
</style></noscript><meta name="generator" content="Hexo 4.2.0"><link rel="alternate" href="/atom.xml" title="向日葵的自我修养" type="application/atom+xml">
</head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="https://i.loli.net/2020/02/15/9iqI5Ug8W2tJBTo.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">33</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">15</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">13</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div></div></div><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true">     </i><div id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#ShardingSphere的前尘往事"><span class="toc-number">1.</span> <span class="toc-text">ShardingSphere的前尘往事</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Apache-ShardingSphere简介"><span class="toc-number">2.</span> <span class="toc-text">Apache ShardingSphere简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Sharding-JDBC简介"><span class="toc-number">3.</span> <span class="toc-text">Sharding-JDBC简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Sharding-JDBC快速入门"><span class="toc-number">4.</span> <span class="toc-text">Sharding-JDBC快速入门</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#建立数据表"><span class="toc-number">4.1.</span> <span class="toc-text">建立数据表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#创建sharding-jdbc-simple项目"><span class="toc-number">4.2.</span> <span class="toc-text">创建sharding-jdbc-simple项目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#编写配置文件"><span class="toc-number">4.3.</span> <span class="toc-text">编写配置文件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#基本配置"><span class="toc-number">4.3.1.</span> <span class="toc-text">基本配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#配置mybatis"><span class="toc-number">4.3.2.</span> <span class="toc-text">配置mybatis</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#配置数据源"><span class="toc-number">4.3.3.</span> <span class="toc-text">配置数据源</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#配置分片规则"><span class="toc-number">4.3.4.</span> <span class="toc-text">配置分片规则</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#配置日志相关"><span class="toc-number">4.3.5.</span> <span class="toc-text">配置日志相关</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#后端测试代码编写"><span class="toc-number">4.4.</span> <span class="toc-text">后端测试代码编写</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#编写启动类"><span class="toc-number">4.4.1.</span> <span class="toc-text">编写启动类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#编写订单实体类"><span class="toc-number">4.4.2.</span> <span class="toc-text">编写订单实体类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#编写mapper接口"><span class="toc-number">4.4.3.</span> <span class="toc-text">编写mapper接口</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#编写单元测试代码"><span class="toc-number">4.4.4.</span> <span class="toc-text">编写单元测试代码</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#小结"><span class="toc-number">4.5.</span> <span class="toc-text">小结</span></a></li></ol></li></ol></div></div></div><div id="body-wrap"><div class="post-bg" id="nav" style="background-image: url(https://cdn.jsdelivr.net/gh/sunchaser-lilu/sunchaser-cdn@master/lilu.org.cn/cover.png)"><div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">向日葵的自我修养</a></span><span class="pull_right menus"><div id="search_button"><a class="site-page social-icon search"><i class="fa fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div><span class="toggle-menu close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span></span></div><div id="post-info"><div id="post-title"><div class="posttitle">分库分表中间件之ShardingSphere-入门案例</div></div><div id="post-meta"><div class="meta-firstline"><time class="post-meta__date"><span class="post-meta__date-created" title="发表于 2019-12-12 20:55:37"><i class="fa fa-calendar" aria-hidden="true"></i> 发表于 2019-12-12</span><span class="post-meta__separator">|</span><span class="post-meta__date-updated" title="更新于 2020-02-15 15:19:06"><i class="fa fa-history" aria-hidden="true"></i> 更新于 2020-02-15</span></time><span class="post-meta__categories"><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6/">中间件</a><i class="fa fa-angle-right post-meta__separator" aria-hidden="true"></i><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6/%E5%88%86%E5%BA%93%E5%88%86%E8%A1%A8/">分库分表</a></span></div><div class="meta-secondline"> <span class="post-meta-wordcount"><i class="post-meta__icon fa fa-file-word-o" aria-hidden="true"></i><span>字数总计:</span><span class="word-count">3.7k</span><span class="post-meta__separator">|</span><i class="post-meta__icon fa fa-clock-o" aria-hidden="true"></i><span>阅读时长: 17 分钟</span></span></div><div class="meta-thirdline"><span class="post-meta-pv-cv"><span class="post-meta__separator">|</span><i class="fa fa-eye post-meta__icon" aria-hidden="true"> </i><span>阅读量:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-commentcount"><span class="post-meta__separator">|</span><i class="post-meta__icon fa fa-comment-o" aria-hidden="true"></i><span>评论数:</span><a href="/2019/12/12/middleware/sharding-sphere/sharding-jdbc-introduction/#post-comment" itemprop="discussionUrl"><span class="valine-comment-count comment-count" data-xid="/2019/12/12/middleware/sharding-sphere/sharding-jdbc-introduction/" itemprop="commentCount"></span></a></span></div></div></div></div><main class="layout_post" id="content-inner"><article id="post"><span style="display: none;">版权所有，禁止爬虫。</span><div class="post-copyright__author" style="display: none;"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:admin@lilu.org.cn">SunChaser</a></span></div><div class="post-copyright__type" style="display: none;"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://lilu.org.cn/2019/12/12/middleware/sharding-sphere/sharding-jdbc-introduction/">https://lilu.org.cn/2019/12/12/middleware/sharding-sphere/sharding-jdbc-introduction/</a></span></div><div class="post-copyright__notice" style="display: none;"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://lilu.org.cn" target="_blank">向日葵的自我修养</a>！</span></div><div id="article-container"><h2 id="ShardingSphere的前尘往事"><a href="#ShardingSphere的前尘往事" class="headerlink" title="ShardingSphere的前尘往事"></a>ShardingSphere的前尘往事</h2><p>ShardingSphere的前身是Sharding-JDBC，起源于当当网内部应用框架，于2016年初开源。</p>
<p>2017年，Sharding-JDBC进入2.x阶段，核心功能是数据库治理。</p>
<p>2018年春节前夕，Sharding-JDBC团队于京东数科重新组建，并将其定位为面向云原生的数据库中间件，正式更名为ShardingSphere。Sharding-JDBC进入了3.x时代，功能重心转向了Sharding-proxy及分布式事务上。</p>
<p>美国时间2018年11月10日，分布式数据库中间件生态圈 ShardingSphere正式进入Apache基金会孵化器。</p>
<p>预祝ShardingSphere项目早日成功毕业。</p>
<h2 id="Apache-ShardingSphere简介"><a href="#Apache-ShardingSphere简介" class="headerlink" title="Apache ShardingSphere简介"></a>Apache ShardingSphere简介</h2><p>Apache ShardingSphere (Incubator) 是一套开源的分布式数据库中间件解决方案组成的生态圈，它由Sharding-JDBC、Sharding-Proxy和Sharding-Sidecar（规划中）这3款相互独立，却又能够混合部署配合使用的产品组成。它们均提供标准化的数据分片、分布式事务和数据库治理功能，可适用于如Java同构、异构语言、云原生等各种多样化的应用场景。</p>
<p>Apache官方发布从4.0.0版本开始。</p>
<p><a href="https://shardingsphere.apache.org/document/current/cn/overview/" target="_blank" rel="noopener">Apache ShardingSphere官方文档</a></p>
<h2 id="Sharding-JDBC简介"><a href="#Sharding-JDBC简介" class="headerlink" title="Sharding-JDBC简介"></a>Sharding-JDBC简介</h2><p>定位为轻量级Java框架，在Java的JDBC层提供的额外服务。 它使用客户端直连数据库，以jar包形式提供服务，无需额外部署和依赖，可理解为增强版的JDBC驱动，完全兼容JDBC和各种ORM框架。</p>
<h2 id="Sharding-JDBC快速入门"><a href="#Sharding-JDBC快速入门" class="headerlink" title="Sharding-JDBC快速入门"></a>Sharding-JDBC快速入门</h2><p>我们以一库两表的案例来快速入门。</p>
<h3 id="建立数据表"><a href="#建立数据表" class="headerlink" title="建立数据表"></a>建立数据表</h3><p>这里我们以简单的订单表为例，作为入门学习使用。</p>
<p>首先建立一库两表的数据库结构。数据库名为sharding_jdbc_db，建立t_order_1和t_order_2两张表。</p>
<p>建表sql语句如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">-- 分表结构</span><br><span class="line">DROP TABLE IF EXISTS t_order_1;</span><br><span class="line">DROP TABLE IF EXISTS t_order_2;</span><br><span class="line">CREATE TABLE &#96;sharding_jdbc_db&#96;.&#96;t_order_1&#96;  (</span><br><span class="line">  &#96;order_id&#96; varchar(32) NOT NULL COMMENT &#39;主键：订单id&#39;,</span><br><span class="line">  &#96;price&#96; decimal(10, 2) NOT NULL COMMENT &#39;订单金额&#39;,</span><br><span class="line">  &#96;user_id&#96; varchar(32) NOT NULL COMMENT &#39;用户id&#39;,</span><br><span class="line">  &#96;status&#96; varchar(16) NOT NULL COMMENT &#39;订单状态&#39;,</span><br><span class="line">  PRIMARY KEY (&#96;order_id&#96;)</span><br><span class="line">) ENGINE &#x3D; InnoDB CHARACTER SET &#x3D; utf8;</span><br><span class="line"></span><br><span class="line">CREATE TABLE &#96;sharding_jdbc_db&#96;.&#96;t_order_2&#96;  (</span><br><span class="line">  &#96;order_id&#96; varchar(32) NOT NULL COMMENT &#39;主键：订单id&#39;,</span><br><span class="line">  &#96;price&#96; decimal(10, 2) NOT NULL COMMENT &#39;订单金额&#39;,</span><br><span class="line">  &#96;user_id&#96; varchar(32) NOT NULL COMMENT &#39;用户id&#39;,</span><br><span class="line">  &#96;status&#96; varchar(16) NOT NULL COMMENT &#39;订单状态&#39;,</span><br><span class="line">  PRIMARY KEY (&#96;order_id&#96;)</span><br><span class="line">) ENGINE &#x3D; InnoDB CHARACTER SET &#x3D; utf8;</span><br></pre></td></tr></table></figure>

<h3 id="创建sharding-jdbc-simple项目"><a href="#创建sharding-jdbc-simple项目" class="headerlink" title="创建sharding-jdbc-simple项目"></a>创建sharding-jdbc-simple项目</h3><p>使用IDEA创建一个maven的空模板项目，项目名为sharding-jdbc-simple。</p>
<p>在pom.xml文件中需添加的sharding-jdbc-spring-boot-starter依赖如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- apache sharding-jdbc --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.apache.shardingsphere&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;sharding-jdbc-spring-boot-starter&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;4.0.0-RC1&lt;&#x2F;version&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure>

<p>由于我的项目使用了自己定义的统一依赖管理，所以没有指定各个jar包的版本号。</p>
<p>读者可以参考 <a href="https://github.com/sunchaser-lilu/plaid-umbrella/tree/master/sunchaser-boot-dependencies" target="_blank" rel="noopener">sunchaser-boot-dependencies</a> 进行实现，或者单独指定对应版本号。</p>
<p>完整的pom.xml内容如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;project xmlns&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0&quot;</span><br><span class="line">         xmlns:xsi&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema-instance&quot;</span><br><span class="line">         xsi:schemaLocation&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0 http:&#x2F;&#x2F;maven.apache.org&#x2F;xsd&#x2F;maven-4.0.0.xsd&quot;&gt;</span><br><span class="line">    &lt;parent&gt;</span><br><span class="line">        &lt;artifactId&gt;中间件&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;groupId&gt;com.sunchaser&lt;&#x2F;groupId&gt;</span><br><span class="line">        &lt;version&gt;1.0-SNAPSHOT&lt;&#x2F;version&gt;</span><br><span class="line">    &lt;&#x2F;parent&gt;</span><br><span class="line">    &lt;modelVersion&gt;4.0.0&lt;&#x2F;modelVersion&gt;</span><br><span class="line"></span><br><span class="line">    &lt;artifactId&gt;sharding-jdbc-simple&lt;&#x2F;artifactId&gt;</span><br><span class="line"></span><br><span class="line">    &lt;dependencyManagement&gt;</span><br><span class="line">        &lt;dependencies&gt;</span><br><span class="line">            &lt;dependency&gt;</span><br><span class="line">                &lt;groupId&gt;com.sunchaser.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">                &lt;artifactId&gt;sunchaser-boot-dependencies&lt;&#x2F;artifactId&gt;</span><br><span class="line">                &lt;version&gt;1.0-SNAPSHOT&lt;&#x2F;version&gt;</span><br><span class="line">                &lt;type&gt;pom&lt;&#x2F;type&gt;</span><br><span class="line">                &lt;scope&gt;import&lt;&#x2F;scope&gt;</span><br><span class="line">            &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;&#x2F;dependencies&gt;</span><br><span class="line">    &lt;&#x2F;dependencyManagement&gt;</span><br><span class="line"></span><br><span class="line">    &lt;dependencies&gt;</span><br><span class="line">        &lt;!-- sharding-jdbc依赖 --&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.apache.shardingsphere&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;sharding-jdbc-spring-boot-starter&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;!-- test依赖 --&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-test&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;!-- web依赖 --&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-web&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;!-- mybatis依赖 --&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.mybatis.spring.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;mybatis-spring-boot-starter&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;!-- druid连接池 --&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;com.alibaba&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;druid-spring-boot-starter&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;!-- mysql驱动 --&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;mysql&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;mysql-connector-java&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;scope&gt;runtime&lt;&#x2F;scope&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;!-- lombok --&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.projectlombok&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;lombok&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;scope&gt;provided&lt;&#x2F;scope&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">    &lt;&#x2F;dependencies&gt;</span><br><span class="line">    &lt;build&gt;</span><br><span class="line">        &lt;plugins&gt;</span><br><span class="line">            &lt;plugin&gt;</span><br><span class="line">                &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">                &lt;artifactId&gt;spring-boot-maven-plugin&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;&#x2F;plugin&gt;</span><br><span class="line">        &lt;&#x2F;plugins&gt;</span><br><span class="line">    &lt;&#x2F;build&gt;</span><br><span class="line">&lt;&#x2F;project&gt;</span><br></pre></td></tr></table></figure>

<h3 id="编写配置文件"><a href="#编写配置文件" class="headerlink" title="编写配置文件"></a>编写配置文件</h3><p>springboot项目可使用properties配置或yaml配置。二选一即可。</p>
<h4 id="基本配置"><a href="#基本配置" class="headerlink" title="基本配置"></a>基本配置</h4><p>配置tomcat端口号、应用名和允许重复定义的bean进行覆盖。</p>
<p>properties配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">server.port&#x3D;520</span><br><span class="line">spring.application.name&#x3D;sharding-jdbc-simple-demo</span><br><span class="line"># 重复的bean定义进行覆盖</span><br><span class="line">spring.main.allow-bean-definition-overriding&#x3D;true</span><br></pre></td></tr></table></figure>

<p>yaml配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">server:</span><br><span class="line">  port: 520</span><br><span class="line">spring:</span><br><span class="line">  application:</span><br><span class="line">    name: sharding-jdbc-simple-demo</span><br><span class="line">  main:</span><br><span class="line">    # 重复的bean会进行覆盖</span><br><span class="line">    allow-bean-definition-overriding: true</span><br></pre></td></tr></table></figure>

<h4 id="配置mybatis"><a href="#配置mybatis" class="headerlink" title="配置mybatis"></a>配置mybatis</h4><p>主要配置xml文件映射路径和下划线自动转驼峰。</p>
<p>properties配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">########################################################################</span><br><span class="line">#</span><br><span class="line">#     mybatis配置</span><br><span class="line">#</span><br><span class="line">#########################################################################</span><br><span class="line"># xml映射文件路径</span><br><span class="line">mybatis.mapper-locations&#x3D;classpath:mapper&#x2F;**&#x2F;*.xml</span><br><span class="line"># 下划线自动转驼峰</span><br><span class="line">mybatis.configuration.map-underscore-to-camel-case&#x3D;true</span><br></pre></td></tr></table></figure>

<p>yaml配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mybatis:</span><br><span class="line">  # xml映射文件路径</span><br><span class="line">  mapper-locations: classpath:mapper&#x2F;**&#x2F;*.xml</span><br><span class="line">  configuration:</span><br><span class="line">    # 自动转驼峰</span><br><span class="line">    map-underscore-to-camel-case: true</span><br></pre></td></tr></table></figure>

<h4 id="配置数据源"><a href="#配置数据源" class="headerlink" title="配置数据源"></a>配置数据源</h4><p>此入门案例是一库两表，只有一个数据源需要配置。</p>
<p>properties配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">########################################################################</span><br><span class="line">#</span><br><span class="line">#     数据源配置</span><br><span class="line">#</span><br><span class="line">#########################################################################</span><br><span class="line"># 数据源名称，多数据源以逗号分隔</span><br><span class="line">spring.shardingsphere.datasource.names&#x3D;ds1</span><br><span class="line"># 数据源ds1详情配置</span><br><span class="line">spring.shardingsphere.datasource.ds1.type&#x3D;com.alibaba.druid.pool.DruidDataSource</span><br><span class="line">spring.shardingsphere.datasource.ds1.driver-class-name&#x3D;com.mysql.cj.jdbc.Driver</span><br><span class="line">spring.shardingsphere.datasource.ds1.url&#x3D;jdbc:mysql:&#x2F;&#x2F;127.0.0.1:3306&#x2F;sharding_jdbc_db?useUnicode&#x3D;true&amp;serverTimezone&#x3D;Asia&#x2F;Shanghai</span><br><span class="line">spring.shardingsphere.datasource.ds1.username&#x3D;root</span><br><span class="line">spring.shardingsphere.datasource.ds1.password&#x3D;ll970722</span><br></pre></td></tr></table></figure>

<p>yaml配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  # 数据源配置</span><br><span class="line">  shardingsphere:</span><br><span class="line">    datasource:</span><br><span class="line">      # 数据源名称，多数据源以逗号分隔</span><br><span class="line">      names: ds1</span><br><span class="line">      # 数据源ds1详情配置</span><br><span class="line">      ds1:</span><br><span class="line">        type: com.alibaba.druid.pool.DruidDataSource</span><br><span class="line">        driver-class-name: com.mysql.cj.jdbc.Driver</span><br><span class="line">        url: jdbc:mysql:&#x2F;&#x2F;127.0.0.1:3306&#x2F;sharding_jdbc_db?useUnicode&#x3D;true&amp;serverTimezone&#x3D;Asia&#x2F;Shanghai</span><br><span class="line">        username: root</span><br><span class="line">        password: ll970722</span><br></pre></td></tr></table></figure>

<h4 id="配置分片规则"><a href="#配置分片规则" class="headerlink" title="配置分片规则"></a>配置分片规则</h4><p>使用默认的inline表达式配置分片策略，分片策略包含分片键和分片算法，需符合groovy语法。</p>
<p>properties配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># 分片规则配置</span><br><span class="line"># 真实数据节点，由数据源名 + 表名组成，以小数点分隔</span><br><span class="line">spring.shardingsphere.sharding.tables.t_order.actual-data-nodes&#x3D;ds1.t_order_$-&gt;&#123;1..2&#125;</span><br><span class="line"># 主键列名称，缺省表示不使用自增主键生成器</span><br><span class="line">spring.shardingsphere.sharding.tables.t_order.key-generator.column&#x3D;order_id</span><br><span class="line"># 自增列值生成器类型，缺省表示使用默认自增列值生成器。</span><br><span class="line"># 可使用自定义的列值生成器或选择内置类型：SNOWFLAKE&#x2F;UUID&#x2F;LEAF_SEGMENT</span><br><span class="line"># 这里使用SNOWFLAKE雪花算法</span><br><span class="line">spring.shardingsphere.sharding.tables.t_order.key-generator.type&#x3D;SNOWFLAKE</span><br><span class="line"># 分片策略（分片键和分片算法）</span><br><span class="line"># 分片键</span><br><span class="line">spring.shardingsphere.sharding.tables.t_order.table-strategy.inline.sharding-column&#x3D;order_id</span><br><span class="line"># 分片算法 生成的ID为奇数，插入到t_order_2中，偶数则插入到t_order_1中</span><br><span class="line">spring.shardingsphere.sharding.tables.t_order.table-strategy.inline.algorithm-expression&#x3D;t_order_$-&gt;&#123;order_id % 2 + 1&#125;</span><br></pre></td></tr></table></figure>

<p>yaml配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  shardingsphere:</span><br><span class="line">    # sharding-jdbc分片规则配置</span><br><span class="line">    sharding:</span><br><span class="line">      tables:</span><br><span class="line">        t_order:</span><br><span class="line">          # 数据节点</span><br><span class="line">          actual-data-nodes: ds1.t_order_$-&gt;&#123;1..2&#125;</span><br><span class="line">          # 主键列和主键生成策略：雪花算法</span><br><span class="line">          key-generator:</span><br><span class="line">            column: order_id</span><br><span class="line">            type: SNOWFLAKE</span><br><span class="line">          # 分片策略</span><br><span class="line">          table-strategy:</span><br><span class="line">            inline:</span><br><span class="line">              # 分片键</span><br><span class="line">              sharding-column: order_id</span><br><span class="line">              # 分片算法：生成的ID为奇数，插入到t_order_2中，偶数则插入到t_order_1中</span><br><span class="line">              algorithm-expression: t_order_$-&gt;&#123;order_id % 2 + 1&#125;</span><br></pre></td></tr></table></figure>

<h4 id="配置日志相关"><a href="#配置日志相关" class="headerlink" title="配置日志相关"></a>配置日志相关</h4><p>配置打印执行的真实sql与日志级别。</p>
<p>properties配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 打印sharding-jdbc的真实执行sql日志</span><br><span class="line">spring.shardingsphere.props.sql.show&#x3D;true</span><br><span class="line"># 日志级别配置</span><br><span class="line">logging.level.root&#x3D;info</span><br><span class="line">logging.level.org.springframework.web&#x3D;info</span><br><span class="line">logging.level.com.sunchaser.shardingjdbc&#x3D;debug</span><br><span class="line">logging.level.druid.sql&#x3D;debug</span><br></pre></td></tr></table></figure>

<p>yaml配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  shardingsphere:</span><br><span class="line">    props:</span><br><span class="line">      sql:</span><br><span class="line">        # 打印sharding-jdbc的真实执行sql日志</span><br><span class="line">        show: true</span><br><span class="line">        </span><br><span class="line"># 日志级别</span><br><span class="line">logging:</span><br><span class="line">  level:</span><br><span class="line">    root: info</span><br><span class="line">    org:</span><br><span class="line">      springframework:</span><br><span class="line">        web: info</span><br><span class="line">    com:</span><br><span class="line">      sunchaser:</span><br><span class="line">        shardingjdbc: debug</span><br><span class="line">    druid:</span><br><span class="line">      sql: debug</span><br></pre></td></tr></table></figure>

<p>至此，配置部分完成，开始编写后端代码。</p>
<h3 id="后端测试代码编写"><a href="#后端测试代码编写" class="headerlink" title="后端测试代码编写"></a>后端测试代码编写</h3><p>项目包结构如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">└─src</span><br><span class="line">    ├─main</span><br><span class="line">    │  ├─java</span><br><span class="line">    │  │  └─com</span><br><span class="line">    │  │      └─sunchaser</span><br><span class="line">    │  │          └─shardingjdbc  ------ 存放启动类</span><br><span class="line">    │  │              ├─entity  -------- 存放实体类</span><br><span class="line">    │  │              └─mapper  -------- 存放mapper接口</span><br><span class="line">    │  └─resources</span><br><span class="line">    │      ├─db  ----------------------- 存放建表语句</span><br><span class="line">    │      └─mapper  ------------------- 存放xml映射文件</span><br><span class="line">    └─test</span><br><span class="line">        └─java</span><br><span class="line">            └─com</span><br><span class="line">                └─sunchaser</span><br><span class="line">                    └─shardingjdbc</span><br><span class="line">                        └─mapper  ------ 存放单元测试类</span><br></pre></td></tr></table></figure>

<p>入门案例主要是使用Sharding-JDBC进行新增和查询，mybatis的mapper接口和xml映射文件编写方式保持不变。</p>
<h4 id="编写启动类"><a href="#编写启动类" class="headerlink" title="编写启动类"></a>编写启动类</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">package com.sunchaser.shardingjdbc;</span><br><span class="line"></span><br><span class="line">import org.springframework.boot.WebApplicationType;</span><br><span class="line">import org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line">import org.springframework.boot.builder.SpringApplicationBuilder;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * @author sunchaser</span><br><span class="line"> * @date 2019&#x2F;11&#x2F;26</span><br><span class="line"> * @description</span><br><span class="line"> * @since 1.0</span><br><span class="line"> *&#x2F;</span><br><span class="line">@SpringBootApplication</span><br><span class="line">public class ShardingJdbcSimpleApplication &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        new SpringApplicationBuilder(ShardingJdbcSimpleApplication.class)</span><br><span class="line">                .web(WebApplicationType.SERVLET)</span><br><span class="line">                .run(args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="编写订单实体类"><a href="#编写订单实体类" class="headerlink" title="编写订单实体类"></a>编写订单实体类</h4><p>使用lombok工具包的@Data和@Builder注解生成getter、setter和建造者模式代码。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">package com.sunchaser.shardingjdbc.entity;</span><br><span class="line"></span><br><span class="line">import lombok.Builder;</span><br><span class="line">import lombok.Data;</span><br><span class="line"></span><br><span class="line">import java.math.BigDecimal;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * @author sunchaser</span><br><span class="line"> * @date 2019&#x2F;11&#x2F;29</span><br><span class="line"> * @description</span><br><span class="line"> * @since 1.0</span><br><span class="line"> *&#x2F;</span><br><span class="line">@Data</span><br><span class="line">@Builder</span><br><span class="line">public class OrderEntity &#123;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 订单id：雪花算法生成的分布式唯一ID</span><br><span class="line">     *&#x2F;</span><br><span class="line">    private Long orderId;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 订单价格</span><br><span class="line">     *&#x2F;</span><br><span class="line">    private BigDecimal price;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 用户id</span><br><span class="line">     *&#x2F;</span><br><span class="line">    private String userId;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 订单状态</span><br><span class="line">     *&#x2F;</span><br><span class="line">    private String status;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="编写mapper接口"><a href="#编写mapper接口" class="headerlink" title="编写mapper接口"></a>编写mapper接口</h4><ol>
<li>插入订单（注解实现）</li>
<li>根据订单ID的集合查询订单信息集合（注解实现）</li>
<li>根据订单ID的集合查询订单信息集合（XML实现）</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">package com.sunchaser.shardingjdbc.mapper;</span><br><span class="line"></span><br><span class="line">import com.sunchaser.shardingjdbc.entity.OrderEntity;</span><br><span class="line">import org.apache.ibatis.annotations.Insert;</span><br><span class="line">import org.apache.ibatis.annotations.Mapper;</span><br><span class="line">import org.apache.ibatis.annotations.Param;</span><br><span class="line">import org.apache.ibatis.annotations.Select;</span><br><span class="line"></span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * @author sunchaser</span><br><span class="line"> * @date 2019&#x2F;11&#x2F;28</span><br><span class="line"> * @description</span><br><span class="line"> * @since 1.0</span><br><span class="line"> *&#x2F;</span><br><span class="line">@Mapper</span><br><span class="line">public interface OrderMapper &#123;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 插入</span><br><span class="line">     * @param orderEntity 订单实体</span><br><span class="line">     * @return 影响记录行数</span><br><span class="line">     *&#x2F;</span><br><span class="line">    @Insert(&quot;insert into t_order(price,user_id,status) values(#&#123;price&#125;,#&#123;userId&#125;,#&#123;status&#125;)&quot;)</span><br><span class="line">    Integer insert(OrderEntity orderEntity);</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 注解实现</span><br><span class="line">     * 根据订单id集合查询订单集合</span><br><span class="line">     * @param orderIds 订单ID集合</span><br><span class="line">     * @return 订单集合</span><br><span class="line">     *&#x2F;</span><br><span class="line">    @Select(&quot; &lt;script&gt; &quot; +</span><br><span class="line">            &quot; select * from t_order t where t.order_id in &quot; +</span><br><span class="line">            &quot; &lt;foreach collection&#x3D;&#39;orderIds&#39; open&#x3D;&#39;(&#39; separator&#x3D;&#39;,&#39; close&#x3D;&#39;)&#39; item&#x3D;&#39;orderId&#39;&gt; &quot; +</span><br><span class="line">            &quot; #&#123;orderId&#125; &quot; +</span><br><span class="line">            &quot; &lt;&#x2F;foreach&gt; &quot; +</span><br><span class="line">            &quot; &lt;&#x2F;script&gt; &quot;)</span><br><span class="line">    List&lt;OrderEntity&gt; selectByAnnotation(@Param(&quot;orderIds&quot;) List&lt;Long&gt; orderIds);</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * xml 实现</span><br><span class="line">     * @param orderIds</span><br><span class="line">     * @return</span><br><span class="line">     *&#x2F;</span><br><span class="line">    List&lt;OrderEntity&gt; selectByXml(@Param(&quot;orderIds&quot;) List&lt;Long&gt; orderIds);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>OrderMapper的selectByXml方法对应的XML配置如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE mapper PUBLIC &quot;-&#x2F;&#x2F;mybatis.org&#x2F;&#x2F;DTD Mapper 3.0&#x2F;&#x2F;EN&quot; &quot;http:&#x2F;&#x2F;mybatis.org&#x2F;dtd&#x2F;mybatis-3-mapper.dtd&quot;&gt;</span><br><span class="line">&lt;mapper namespace&#x3D;&quot;com.sunchaser.shardingjdbc.mapper.OrderMapper&quot;&gt;</span><br><span class="line">    &lt;select id&#x3D;&quot;selectByXml&quot;</span><br><span class="line">            resultType&#x3D;&quot;com.sunchaser.shardingjdbc.entity.OrderEntity&quot;&gt;</span><br><span class="line">        select * from t_order where order_id in</span><br><span class="line">        &lt;foreach collection&#x3D;&#39;orderIds&#39; item&#x3D;&#39;orderId&#39; open&#x3D;&#39;(&#39; separator&#x3D;&#39;,&#39; close&#x3D;&#39;)&#39;&gt;</span><br><span class="line">            #&#123;orderId&#125;</span><br><span class="line">        &lt;&#x2F;foreach&gt;</span><br><span class="line">    &lt;&#x2F;select&gt;</span><br><span class="line">&lt;&#x2F;mapper&gt;</span><br></pre></td></tr></table></figure>

<h4 id="编写单元测试代码"><a href="#编写单元测试代码" class="headerlink" title="编写单元测试代码"></a>编写单元测试代码</h4><p>首先循环调用OrderMapper的insert方法插入20条订单数据，然后分别选择同一个订单表的两个订单orderId和选择不同订单表的两个orderId进行<code>in</code>查询。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">package com.sunchaser.shardingjdbc.mapper;</span><br><span class="line"></span><br><span class="line">import com.google.common.collect.Lists;</span><br><span class="line">import com.sunchaser.shardingjdbc.entity.OrderEntity;</span><br><span class="line">import org.junit.Test;</span><br><span class="line">import org.junit.runner.RunWith;</span><br><span class="line">import org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line">import org.springframework.test.context.junit4.SpringRunner;</span><br><span class="line"></span><br><span class="line">import javax.annotation.Resource;</span><br><span class="line">import java.math.BigDecimal;</span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * @author sunchaser</span><br><span class="line"> * @date 2019&#x2F;11&#x2F;28</span><br><span class="line"> * @description</span><br><span class="line"> * @since 1.0</span><br><span class="line"> *&#x2F;</span><br><span class="line">@SpringBootTest</span><br><span class="line">@RunWith(SpringRunner.class)</span><br><span class="line">public class OrderMapperTest &#123;</span><br><span class="line"></span><br><span class="line">    @Resource</span><br><span class="line">    private OrderMapper orderMapper;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    public void insert() &#123;</span><br><span class="line">        for (int i &#x3D; 0; i &lt; 20; i++) &#123;</span><br><span class="line">            OrderEntity orderEntity &#x3D; OrderEntity.builder()</span><br><span class="line">                    .price(new BigDecimal(&quot;1.11&quot;))</span><br><span class="line">                    .userId(&quot;2019xxxxxxxx&quot;)</span><br><span class="line">                    .status(&quot;SUCCESS&quot;)</span><br><span class="line">                    .build();</span><br><span class="line">            Integer success &#x3D; orderMapper.insert(orderEntity);</span><br><span class="line">            System.out.println(success);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    public void selectByAnnotation() &#123;</span><br><span class="line">        List&lt;Long&gt; orderIds &#x3D; Lists.newArrayList(406907714078244865L,407114454203891712L);</span><br><span class="line">        List&lt;OrderEntity&gt; orderEntities &#x3D; orderMapper.selectByAnnotation(orderIds);</span><br><span class="line">        System.out.println(orderEntities);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    public void selectByXml() &#123;</span><br><span class="line">        List&lt;Long&gt; orderIds &#x3D; Lists.newArrayList(406907714078244865L,407114454203891712L);</span><br><span class="line">        List&lt;OrderEntity&gt; orderEntities &#x3D; orderMapper.selectByXml(orderIds);</span><br><span class="line">        System.out.println(orderEntities);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>由于前面配置了sql日志打印，我们可在控制台看到执行的逻辑SQL和真实SQL。</p>
<p>以查询方法selectByAnnotation为例，执行日志如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">2019-12-12 11:05:36.399 DEBUG 17328 --- [           main] c.s.s.m.OrderMapper.selectByAnnotation   : &#x3D;&#x3D;&gt;  Preparing: select * from t_order t where t.order_id in ( ? , ? ) </span><br><span class="line">2019-12-12 11:05:36.459 DEBUG 17328 --- [           main] c.s.s.m.OrderMapper.selectByAnnotation   : &#x3D;&#x3D;&gt; Parameters: 406907714078244865(Long), 407114454203891712(Long)</span><br><span class="line">2019-12-12 11:05:37.778  INFO 17328 --- [           main] ShardingSphere-SQL                       : Rule Type: sharding</span><br><span class="line">2019-12-12 11:05:37.783  INFO 17328 --- [           main] ShardingSphere-SQL                       : Logic SQL: select * from t_order t where t.order_id in   (    ?   ,   ?   )</span><br><span class="line">2019-12-12 11:05:37.784  INFO 17328 --- [           main] ShardingSphere-SQL                       : SQLStatement: SelectStatement(super&#x3D;DQLStatement(super&#x3D;AbstractSQLStatement(type&#x3D;DQL, tables&#x3D;Tables(tables&#x3D;[Table(name&#x3D;t_order, alias&#x3D;Optional.of(t))]), routeConditions&#x3D;Conditions(orCondition&#x3D;OrCondition(andConditions&#x3D;[AndCondition(conditions&#x3D;[Condition(column&#x3D;Column(name&#x3D;order_id, tableName&#x3D;t_order), operator&#x3D;IN, compareOperator&#x3D;null, positionValueMap&#x3D;&#123;&#125;, positionIndexMap&#x3D;&#123;0&#x3D;0, 1&#x3D;1&#125;)])])), encryptConditions&#x3D;Conditions(orCondition&#x3D;OrCondition(andConditions&#x3D;[])), sqlTokens&#x3D;[TableToken(tableName&#x3D;t_order, quoteCharacter&#x3D;NONE, schemaNameLength&#x3D;0)], parametersIndex&#x3D;2, logicSQL&#x3D;select * from t_order t where t.order_id in   (    ?   ,   ?   ))), containStar&#x3D;true, firstSelectItemStartIndex&#x3D;7, selectListStopIndex&#x3D;7, groupByLastIndex&#x3D;0, items&#x3D;[StarSelectItem(owner&#x3D;Optional.absent())], groupByItems&#x3D;[], orderByItems&#x3D;[], limit&#x3D;null, subqueryStatement&#x3D;null, subqueryStatements&#x3D;[], subqueryConditions&#x3D;[])</span><br><span class="line">2019-12-12 11:05:37.786  INFO 17328 --- [           main] ShardingSphere-SQL                       : Actual SQL: ds1 ::: select * from t_order_1 t where t.order_id in   (    ?   ,   ?   ) ::: [406907714078244865, 407114454203891712]</span><br><span class="line">2019-12-12 11:05:37.786  INFO 17328 --- [           main] ShardingSphere-SQL                       : Actual SQL: ds1 ::: select * from t_order_2 t where t.order_id in   (    ?   ,   ?   ) ::: [406907714078244865, 407114454203891712]</span><br><span class="line">2019-12-12 11:05:38.062 DEBUG 17328 --- [           main] c.s.s.m.OrderMapper.selectByAnnotation   : &lt;&#x3D;&#x3D;      Total: 2</span><br><span class="line">[OrderEntity(orderId&#x3D;407114454203891712, price&#x3D;1.11, userId&#x3D;2019xxxxxxxx, status&#x3D;SUCCESS), OrderEntity(orderId&#x3D;406907714078244865, price&#x3D;1.11, userId&#x3D;2019xxxxxxxxxxxxxxx, status&#x3D;SUCCESS)]</span><br></pre></td></tr></table></figure>

<p>可看到执行的Logic SQL为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from t_order t where t.order_id in ( ? , ? )</span><br></pre></td></tr></table></figure>

<p>Sharding-JDBC的路由引擎根据解析上下文匹配数据库和表的分片策略，路由到具体的库和表。再经过改写引擎，将逻辑SQL改写为真正执行的SQL。</p>
<p>从日志中可看到改写后的Actual SQL为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select * from t_order_1 t where t.order_id in   (    ?   ,   ?   ) ::: [406907714078244865, 407114454203891712]</span><br><span class="line">select * from t_order_2 t where t.order_id in   (    ?   ,   ?   ) ::: [406907714078244865, 407114454203891712]</span><br></pre></td></tr></table></figure>

<p>结果归并，真实的SQL执行后会返回多个结果集，归并引擎从各个数据节点拿到结果集后组合成一个结果集并返回给客户端。</p>
<p>至此，入门案例就演示结束。源码地址：<a href="https://github.com/sunchaser-lilu/gold-road-to-Java/tree/master/%E4%B8%AD%E9%97%B4%E4%BB%B6/sharding-jdbc-simple" target="_blank" rel="noopener">传送门</a></p>
<p>下一篇文章将对Sharding-JDBC中的一些核心概念进行具体的解释。</p>
<h3 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h3><p>这篇文章主要是对Apache ShardingSphere 4.x与Spring Boot 2.1.x进行整合，使用了内置的SNOWFLAKE雪花算法生成分布式全局唯一ID和使用默认的inline表达式配置分片策略，完成了最简单的一库两表的分库分表，并对新增和查询操作进行了测试。</p>
<div><div style="text-align:center;color: #ccc;font-size:14px;font-family: cursive;">-------------&#x7EB8;&#x77ED;&#x60C5;&#x957F;<i class="fa fa-umbrella" style="margin:0 7px;"></i>&#x4E0E;&#x4F60;&#x8BC9;&#x8BF4;-------------</div></div><div id="wechat_subscriber"><center><img id="wechat_subscriber_qcode" src="https://i.loli.net/2020/02/15/SDRF87I6ohlyVk1.jpg" onerror="onerror=null;src='/assets/images/wechat/wxgzh.jpg'" alt="向日葵的自我修养"></center><div>欢迎关注我的微信公众号~</div></div></div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:admin@lilu.org.cn">SunChaser</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://lilu.org.cn/2019/12/12/middleware/sharding-sphere/sharding-jdbc-introduction/">https://lilu.org.cn/2019/12/12/middleware/sharding-sphere/sharding-jdbc-introduction/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://lilu.org.cn" target="_blank">向日葵的自我修养</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Apache-ShardingSphere/">Apache ShardingSphere</a></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/sunchaser-lilu/sunchaser-cdn@master/lilu.org.cn/cover.png" data-sites="twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"/><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><div class="post-reward"><a class="reward-button button--primary button--animated"> <i class="fa fa-qrcode"></i> 打赏<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="lazyload post-qr-code__img" src="https://i.loli.net/2020/02/15/wBGoHtiL8PqMKWA.png" alt="微信"/><div class="post-qr-code__desc">微信</div></li><li class="reward-item"><img class="lazyload post-qr-code__img" src="https://i.loli.net/2020/02/15/rYEfbjCAyuUGce5.png" alt="支付寶"/><div class="post-qr-code__desc">支付寶</div></li></ul></div></a></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/2019/12/13/java-bucket/"><img class="prev_cover lazyload" data-src="https://cdn.jsdelivr.net/gh/sunchaser-lilu/sunchaser-cdn@master/lilu.org.cn/cover.png" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">JavaBucket</div></div></a></div><div class="next-post pull_right"><a href="/2019/12/12/design-patterns/behavior/strategy/"><img class="next_cover lazyload" data-src="https://cdn.jsdelivr.net/gh/sunchaser-lilu/sunchaser-cdn@master/lilu.org.cn/cover.png" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">“煮熟的鸭子也会飞？”- 使用策略模式让你的“鸭子”飞起来</div></div></a></div></nav><hr><div id="post-comment"><div class="comment_headling"><i class="fa fa-comments fa-fw" aria-hidden="true"></i><span> 评论</span></div><div class="vcomment" id="vcomment"></div><script src="https://cdn.jsdelivr.net/gh/xaoxuu/volantis/js/volantis.min.js"></script><script>var GUEST_INFO = ['nick','mail','link'];
var guest_info = 'nick,mail,link'.split(',').filter(function(item){
  return GUEST_INFO.indexOf(item) > -1
});
guest_info = guest_info.length == 0 ? GUEST_INFO :guest_info;

window.valine = new Valine({
  el:'#vcomment',
  notify: false,
  verify: false,
  appId: 'qc8Hd8UPK33VUIOJ3zDjAn8W-gzGzoHsz',
  appKey: 'K2EAXbjfO9i6G4Myz0gHIIgr',
  placeholder: '记得留下你的昵称和邮箱...可以快速收到回复哦',
  avatar: 'monsterid',
  meta: guest_info,
  pageSize: '10',
  lang: 'zh-cn',
  recordIP: false,
  serverURLs: ''
});</script></div></article></main><footer id="footer" style="background-image: url(https://cdn.jsdelivr.net/gh/sunchaser-lilu/sunchaser-cdn@master/lilu.org.cn/cover.png)" data-type="photo"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2020 By SunChaser</div><div class="footer_custom_text">没有行动的梦想都是妄想~</div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换" target="_self">繁</a><i class="darkmode fa fa-moon-o" id="darkmode" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><a id="to_comment" href="#post-comment" title="直达评论"><i class="scroll_to_comment fa fa-comments">  </i></a><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a href="https://github.com/wzpan/hexo-generator-search" target="_blank" rel="noopener" style="color:#49B1F5;">hexo-generator-search</a>
 <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script id="canvas_nest" color="255,0,0" opacity="0.7" zIndex="-1" count="99" mobile="false" src="/js/third-party/canvas-nest.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/lazysizes@latest/lazysizes.min.js" async=""></script><script src="/js/search/local-search.js"></script></body></html>